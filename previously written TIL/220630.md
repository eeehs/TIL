# 그림으로 공부하는 IT 인프라 구조

3. 3계층형 시스템을 살펴보자 

## 주요 개념 설명

### 프로세스와 스레드

프로세스 및 스레드가 활동하려면 **메모리 공간**이 필요 

**메모리 공간**은 커널에 의해 메모리상에 확보

- 프로세스 시작 시 어떤 일이 발생할까?
    1. OS상에서 프로세스가 시작돼서 사용자 요청을 받을 수 있게 된다. 
    2. 시작 의뢰가 있으면 커널이 프로세스를 작성한다. 또한 요청 분량만큼만 메모리 공간을 할당한다. 
    3. 프로그램은 서버 내부의 디스크상에 설치된다. 

- 메모리 공간을 가지는 것이 ‘프로세스’,’JVM도 프로세스로, 내부에서 수많은 스레드가 동작
- 하나의 프로세스가 동작하고 있으면 내부에서는 메모리 공간을 점유하는 스레드 하나가 동작
- 각 스레드는 메모리 공간을 공유
    - 스레드 시작 시에 신규 메모리 공간은 필요 없지만, 다른 스레드에 이상이 발생하면 영향을 받음
- 프로세스 VS 쓰레드
    
    
    |  | 프로세스 | 스레드 |
    | --- | --- | --- |
    | 장점  | 개별 처리 독립성이 높다 | 생성 시 부하가 낮다. |
    | 단점 | 생성 시 CPU 부하가 높다.  | 메모리 공간을 공유하기 때문에 의도하지 않는 데이터 읽기/쓰기가 발생할 수 있다.  |

### OS 커널

OS에서 커널은 **심장이자 뇌**

커널은 다양한 역할을 갖지만, 가장 중요한 것은 **‘뒤에서 무슨 일이 벌어지는지 은폐하면서도 편리한 인터페이스를 제공하는 것’** 

커널의 역할은 **6가지**로 정리 가능

1. 시스템 콜 인터페이스 
    1. 프로세스나 스레드로부터 명령을 받는 인터페이스 
2. 프로세스 관리 
    1. 가동되고 있는 프로세스 관리와 CPU이용 우선 순위 등을 ‘스케줄’ 한다 
3. 메모리 관리
    1. 서버상의 메모리를 단위 크기(예를 들어, 4KB)의 블록으로 분할해서 프로세스에 할당
4. 네트워크 스택
    1. 네트워크를 관리(자세한 것은 6장에서 추가설명)
5. 파일 시스템 관리
    1. 파일 시스템 관리
6. 장치 드라이버
    1. 디스크,NIC,HBA 등의 물리 장치와 작업 

## 웹 데이터 흐름

### 클라이언트 pc 부터 웹 서버까지

전체 흐름

1. 웹 브라우저가 요청을 발행한다. 
2. 이름 해석을 한다. 
3. 웹 서버가 요청을 접수한다. 
4. 웹 서버가 정적 콘텐츠인지 동적 콘텐츠 인지 판단한다. 
5. 필요한 경로로 데이터에 엑세스 한다. 

### 웹 서버 부터 AP 서버까지

전체 흐름

1. 웹 서버로부터 요청이 도착한다. 
2. 스레드가 요청을 받으면 자신이 계산할 수 있는지, 아니면 DB접속이 필요한지를 판단한다. 
3. DB 접속이 필요하면 연결 풀에 엑세스한다. 
4. DB 서버에 요청을 던진다. 

### AP 서버부터 DB 서버까지

전체 흐름 

1. AP 서버로부터 요청이 도착한다. 
2. 프로세스가 요청을 접수하고 캐시가 존재하는지 확인한다. 
3. 캐시가 없으면 디스크에 엑세스한다. 
4. 디스크가 데이터를 반환한다. 
5. 데이터를 캐시 형태로 저장한다. 
6. 결과를 AP서버에 반환한다. 

### AP 서버부터 웹서버까지

전체 흐름

1. DB서버로부터 데이터가 도착한다. 
2. 스레드가 데이터를 가지고 계산 등을 한 후에 파일 데이터를 생성한다. 
3. 결과를 웹 서버로 반환한다. 

### 웹 서버부터 클라이언트 PC까지

전체 흐름

1. AP 서버로 부터 데이터가 도착한다. 
2. 프로세스는 받은 데이터를 그대로 반환한다. 
3. 결과가 웹 브라우저로 반환되고 화면에 표시된다. 

### 웹 데이터의 흐름 정리

각 서버의 동작은 다르지만 아래와 같이 **공통점이 존재**

- 프로세스나 스레드가 요청을 받는다.
- 도착한 요청을 파악해서 필요에 따라 별도 서버로 요청을 보낸다.
- 도착한 요청에 대해 응답한다.